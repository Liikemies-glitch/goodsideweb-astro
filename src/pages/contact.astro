---
import BaseLayout from '../layouts/BaseLayout.astro';
// import ScheduleSection from '../components/ScheduleSection.astro'; // Removed import
import CalendlyEmbed from '../components/CalendlyEmbed.astro';
import HeroSection from '../components/HeroSection.astro'; // Tuodaan HeroSection

// Remove the old script variable
// const calEmbedScript = ` ... `;

const pageTitle = "Ota yhteyttä | The Good Side";
const pageDescription = "Varaa aika kalenterista tai jätä yhteydenottopyyntö, niin katsotaan miten voimme auttaa.";
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <!-- Korvataan vanha contact-hero HeroSection-komponentilla -->
  <!-- Pienennetään ala-paddingia, koska Calendly tulee heti alle -->
  <!-- Lisätään luokka taustakuvalle -->
  <HeroSection
    title="Jutellaan tuotteesi tulevaisuudesta"
    paddingTop="4rem"
    paddingBottom="1rem" 
    class="contact-hero-bg" 
    textOnly={true}
  >
    <!-- Käytetään slottia ilman Fragmentia -->
    <span slot="paragraph">
      {pageDescription}
      <br/>
      Voit myös <a href="tel:0408698887">soittaa suoraan</a> tai laittaa sähköpostia <a href="mailto:mikki@goodside.fi">mikki@goodside.fi</a>.
    </span>
  </HeroSection>
    <!-- Vanha contact-hero poistettu -->
    <!-- <section class="contact-hero"> ... </section> -->
    <!-- Myös contact-person div poistettu -->
    <!-- Cal inline embed code begins - Siirretty CalendlyEmbed-komponenttiin -->
    <!-- <div style="width:100%;height:100%;overflow:scroll" id="my-cal-inline" class="contact-booking"></div> -->
    <!-- The class="contact-booking" is added back to retain styling -->

  <!-- Container for the Calendly embed for styling/layout purposes -->
  <section class="schedule-section">
    <div class="container">
        <!-- Lisätään id CalendlyEmbediin -->
        <CalendlyEmbed elementId="my-cal-inline" calLink="aaltoyleva/kartoitustapaaminen" />
    </div>
  </section>

  <!-- START: HubSpot Form Section -->
  <section class="contact-form-section">
    <div class="container">
      <div class="form-content" id="hubspot-form-container">
        <h2>Tai jätä yhteydenottopyyntö</h2>
        <p>Jos et löydä sopivaa aikaa tai haluat mieluummin että otan yhteyttä, täytä lomake niin palaan asiaan mahdollisimman pian.</p>
        <!-- HubSpot Embed Code wrapped in template -->
        <template id="hubspot-template">
            <script src="https://js-eu1.hsforms.net/forms/embed/145360432.js" defer></script>
            <div class="hs-form-frame" data-region="eu1" data-form-id="8bc5845c-348d-4ba7-baea-ebd46b11b0a0" data-portal-id="145360432"></div>
        </template>
        <!-- End HubSpot Embed Code -->
      </div>
    </div>
  </section>
  <!-- END: HubSpot Form Section -->

  <!-- Add the new inline script -->
  <script type="text/javascript" is:inline>
    // ... existing code ...

    // HubSpot Lazy Load Script (copied from CTASection)
    document.addEventListener('DOMContentLoaded', () => {
        const formContainer = document.getElementById('hubspot-form-container');
        const template = document.getElementById('hubspot-template');

        if (!formContainer || !template) {
            console.error("HubSpot lazy load elements not found.");
            return;
        }

        const observer = new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const content = template.content.cloneNode(true);
                    const scriptTag = content.querySelector('script');
                    const formDiv = content.querySelector('.hs-form-frame');

                    if (scriptTag && formDiv) {
                        formContainer.appendChild(formDiv);
                        const newScript = document.createElement('script');
                        newScript.src = scriptTag.src;
                        newScript.defer = scriptTag.defer;
                        formContainer.appendChild(newScript); 
                    } else {
                         console.error("HubSpot script or form div not found in template.");
                    }
                    obs.unobserve(formContainer);
                }
            });
        }, { threshold: 0.1 });

        observer.observe(formContainer);
    });
  </script>
  <!-- Cal inline embed code ends -->

</BaseLayout>

<style>
    /* Add some basic styling for the new schedule section if needed */
    .schedule-section {
        padding: var(--spacing-xl) 0;
    }

  /* Lisätään taustakuva HeroSectionille luokan kautta */
  .contact-hero-bg {
    /* padding: 4rem 0; */ /* Padding tulee nyt HeroSection-komponentista */
    background-image: url('/images/mesh-gradient-green.webp');
    background-size: cover;
    background-position: center;
  }

  /* Poistetaan vanhat contact-hero ja contact-grid tyylit */
  /* .contact-hero { ... } */
  /* .contact-grid { ... } */
  /* .contact-content { ... } */
  /* .contact-description { ... } */
  /* .contact-person { ... } */
  /* .contact-booking { ... } */
</style> 